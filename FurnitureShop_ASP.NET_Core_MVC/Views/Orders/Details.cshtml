@model FurnitureShop.Models.Order
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
    var total = Model.OrderDetails.Sum(d => d.Quantity * d.UnitPrice);
}

<h2 class="mb-4">📦 @ViewData["Title"]</h2>

<div class="mb-3">
    <p><b>Người đặt:</b> @Model.User?.UserName</p>
    <p><b>Ngày đặt:</b> @Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</p>
    <p>
        <b>Trạng thái:</b>
        <span class="badge bg-@(Model.Status == "Pending" ? "warning" :
                               Model.Status == "Completed" ? "success" : "secondary")">
            @Model.Status
        </span>
    </p>
</div>

<h4>Sản phẩm</h4>
<table class="table table-striped align-middle">
    <thead class="table-dark">
        <tr>
            <th>Sản phẩm</th>
            <th>Hình ảnh</th>
            <th>Số lượng</th>
            <th>Đơn giá</th>
            <th>Thành tiền</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var d in Model.OrderDetails)
        {
            <tr>
                <td>@d.Product?.Name</td>
                <td>
                    <img src="@(string.IsNullOrWhiteSpace(d.Product?.ImageUrl) ? "https://placehold.co/100x80" : d.Product.ImageUrl)"
                         alt="@d.Product?.Name"
                         style="width:100px; height:80px; object-fit:cover;" />
                </td>
                <td>@d.Quantity</td>
                <td>@d.UnitPrice.ToString("N0") đ</td>
                <td>@(d.Quantity * d.UnitPrice).ToString("N0") đ</td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr class="fw-bold">
            <td colspan="4" class="text-end">Tổng cộng:</td>
            <td>@total.ToString("N0") đ</td>
        </tr>
    </tfoot>
</table>

@if (Model.Payment != null)
{
    <h4 class="mt-4">💳 Thanh toán</h4>
    <p><b>Phương thức:</b> @Model.Payment.Method</p>
    <p><b>Số tiền:</b> @Model.Payment.Amount.ToString("N0") đ</p>
    <p>
        <b>Trạng thái:</b>
        <span class="badge bg-@(Model.Payment.Status == "Pending" ? "warning" :
                               Model.Payment.Status == "Completed" ? "success" : "secondary")">
            @Model.Payment.Status
        </span>
    </p>
}

<div class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Quay lại danh sách đơn hàng
    </a>
</div>
