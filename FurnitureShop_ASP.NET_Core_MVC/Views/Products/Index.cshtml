@model IEnumerable<FurnitureShop.Models.Product>
@{
    ViewData["Title"] = "S·∫£n ph·∫©m";
}

<h1 class="mb-4 fw-bold text-center">üõãÔ∏è Danh s√°ch s·∫£n ph·∫©m</h1>

<!-- üéüÔ∏è M√£ gi·∫£m gi√° n·ªïi b·∫≠t -->
<div class="alert alert-success shadow-sm text-center fw-semibold py-3 mb-4 promo-banner">
    <i class="bi bi-ticket-perforated fs-4 text-danger"></i>
    üî• <span>Khuy·∫øn m√£i HOT:</span>
    <strong class="text-uppercase text-danger">
        @{
            var randomCoupons = new[] { "SALE10", "FURNI20", "NOITHAT15", "VIP5" };
            var random = new Random();
            var coupon = randomCoupons[random.Next(randomCoupons.Length)];
        }
        @coupon
    </strong>
    ‚Äî Gi·∫£m <strong>@(random.Next(5, 20))%</strong> cho ƒë∆°n h√†ng h√¥m nay!
    <a asp-controller="Coupons" asp-action="Index" class="btn btn-sm btn-warning ms-2 shadow-sm">
        <i class="bi bi-gift"></i> Xem t·∫•t c·∫£ m√£
    </a>
</div>

<!-- üîç B·ªô l·ªçc t√¨m ki·∫øm -->
<form method="get" class="row g-3 mb-4 bg-light p-3 rounded shadow-sm">
    <div class="col-md-3">
        <input type="text" name="search" value="@ViewBag.Search" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m...">
    </div>

    <div class="col-md-2">
        <input type="number" step="0.01" name="minPrice" value="@ViewBag.MinPrice" class="form-control" placeholder="Gi√° t·ª´">
    </div>

    <div class="col-md-2">
        <input type="number" step="0.01" name="maxPrice" value="@ViewBag.MaxPrice" class="form-control" placeholder="ƒê·∫øn">
    </div>

    <div class="col-md-3">
        <select name="sort" class="form-select">
            <option value="">M·ªõi nh·∫•t</option>
            <option value="price_asc" selected="@(ViewBag.Sort == "price_asc")">Gi√° tƒÉng d·∫ßn</option>
            <option value="price_desc" selected="@(ViewBag.Sort == "price_desc")">Gi√° gi·∫£m d·∫ßn</option>
        </select>
    </div>

    <div class="col-md-2 text-end">
        <button type="submit" class="btn btn-primary w-100">L·ªçc</button>
    </div>
</form>

<!-- üßÆ Th√¥ng tin trang -->
@if (ViewBag.TotalPages > 0)
{
    <p class="text-center text-muted">
        Hi·ªÉn th·ªã <strong>@Model.Count()</strong> / <strong>@ViewBag.TotalItems</strong> s·∫£n ph·∫©m ‚Äî
        Trang <strong>@ViewBag.Page</strong> / <strong>@ViewBag.TotalPages</strong>
    </p>
}

<!-- üì¶ Danh s√°ch s·∫£n ph·∫©m -->
<div class="row g-4">
    @if (Model != null && Model.Any())
    {
        @foreach (var p in Model)
        {
            <div class="col-md-4 col-sm-6">
                <div class="card h-100 shadow-sm border-0 rounded-3 product-card">
                    <!-- ·∫¢nh s·∫£n ph·∫©m -->
                    <div class="position-relative overflow-hidden rounded-top">
                        <img src="@(string.IsNullOrWhiteSpace(p.ImageUrl) ? "/images/no-image.png" : p.ImageUrl)"
                             class="card-img-top img-hover"
                             alt="@p.Name"
                             data-bs-toggle="tooltip" title="@p.Name" />
                        <span class="badge bg-danger position-absolute top-0 start-0 m-2 shadow">M·ªõi</span>
                    </div>

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-truncate" data-bs-toggle="tooltip" title="@p.Name">
                            @p.Name
                        </h5>

                        <p class="card-text text-truncate text-muted" data-bs-toggle="tooltip" title="@p.Description">
                            @p.Description
                        </p>

                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <!-- ‚úÖ Hi·ªÉn th·ªã gi√° kh√¥ng l·ªói -->
                            <span class="fw-bold text-primary fs-5">@($"{p.Price:N0} ƒë")</span>

                            <!-- Th√™m gi·ªè -->
                            <form asp-controller="Cart" asp-action="Add" method="post" class="d-inline">
                                <input type="hidden" name="productId" value="@p.Id" />
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-success">
                                    <i class="bi bi-cart-plus"></i> Th√™m gi·ªè
                                </button>
                            </form>

                            <!-- Chi ti·∫øt -->
                            <a class="btn btn-sm btn-outline-primary" asp-action="Details" asp-route-id="@p.Id">
                                <i class="bi bi-eye"></i> Chi ti·∫øt
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="alert alert-info text-center">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</div>
    }
</div>

<!-- üìë Ph√¢n trang -->
@if (ViewBag.TotalPages > 1)
{
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            @if (ViewBag.Page > 1)
            {
                <li class="page-item">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-search="@ViewBag.Search"
                       asp-route-minPrice="@ViewBag.MinPrice"
                       asp-route-maxPrice="@ViewBag.MaxPrice"
                       asp-route-sort="@ViewBag.Sort"
                       asp-route-page="@(ViewBag.Page - 1)">
                        &laquo; Tr∆∞·ªõc
                    </a>
                </li>
            }

            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-search="@ViewBag.Search"
                       asp-route-minPrice="@ViewBag.MinPrice"
                       asp-route-maxPrice="@ViewBag.MaxPrice"
                       asp-route-sort="@ViewBag.Sort"
                       asp-route-page="@i">@i</a>
                </li>
            }

            @if (ViewBag.Page < ViewBag.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-search="@ViewBag.Search"
                       asp-route-minPrice="@ViewBag.MinPrice"
                       asp-route-maxPrice="@ViewBag.MaxPrice"
                       asp-route-sort="@ViewBag.Sort"
                       asp-route-page="@(ViewBag.Page + 1)">
                        Sau &raquo;
                    </a>
                </li>
            }
        </ul>
    </nav>
}

<style>
    /* üåü Animation banner coupon */
    @@keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 1;
        }

        50% {
            transform: scale(1.05);
            opacity: 0.85;
        }

        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .promo-banner {
        animation: pulse 2s infinite;
        border-left: 6px solid #28a745;
        background: linear-gradient(90deg, #eaffea, #f8fff8);
    }

    .product-card {
        transition: transform 0.2s ease, box-shadow 0.3s ease;
    }

        .product-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

    .img-hover {
        transition: transform 0.4s ease;
        width: 100%;
        height: 250px;
        object-fit: cover;
        cursor: pointer;
    }

    .product-card:hover .img-hover {
        transform: scale(1.08);
    }

    .pagination .page-link {
        color: #0d6efd;
        border: none;
    }

    .pagination .page-item.active .page-link {
        background-color: #0d6efd;
        color: white;
        border-radius: 6px;
    }

    .pagination .page-link:hover {
        background-color: #e7f0ff;
    }
</style>

@section Scripts {
    <script>
        // Tooltip Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
}
