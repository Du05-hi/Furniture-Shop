@model FurnitureShop.Models.Product
@{
    ViewData["Title"] = Model.Name;
}

<div class="container py-4">
    <div class="row mb-4">
        <!-- ·∫¢nh s·∫£n ph·∫©m -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-3">
                <img src="@(string.IsNullOrWhiteSpace(Model.ImageUrl) ? "https://placehold.co/800x600" : Model.ImageUrl)"
                     alt="@Model.Name"
                     class="card-img-top img-fluid rounded"
                     style="object-fit:cover; height:420px;" />
            </div>
        </div>

        <!-- Th√¥ng tin s·∫£n ph·∫©m -->
        <div class="col-md-6">
            <h2 class="fw-bold">@Model.Name</h2>
            <p class="lead text-muted">@Model.Description</p>
            <h3 class="text-primary fw-bold">@Model.Price.ToString("N0") ƒë</h3>

            <!-- Form th√™m v√†o gi·ªè -->
            <form asp-controller="Cart" asp-action="Add" method="post" class="mt-3">
                <input type="hidden" name="productId" value="@Model.Id" />
                <div class="input-group" style="max-width:240px">
                    <input type="number" name="quantity" value="1" min="1" class="form-control" />
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-cart-plus"></i> Th√™m gi·ªè h√†ng
                    </button>
                </div>
            </form>

            <a class="btn btn-outline-secondary mt-3" asp-action="Index">
                <i class="bi bi-arrow-left"></i> Quay l·∫°i
            </a>
        </div>
    </div>

    <hr />

    <!-- ‚≠ê PH·∫¶N REVIEW -->
    <h3 class="mb-3 fw-bold">ƒê√°nh gi√° s·∫£n ph·∫©m</h3>

    @if (Model.Reviews != null && Model.Reviews.Any())
    {
        foreach (var r in Model.Reviews.OrderByDescending(r => r.CreatedAt))
        {
            <div class="border rounded p-3 mb-3 shadow-sm bg-light">
                <strong>@(r.User?.UserName ?? "·∫®n danh")</strong> -
                <span class="text-warning">
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= r.Rating)
                        {
                            <i class="bi bi-star-fill"></i>
                        }
                        else
                        {
                            <i class="bi bi-star"></i>
                        }
                    }
                </span>
                <p class="mb-1">@r.Comment</p>
                <small class="text-muted">@r.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
            </div>
        }
    }
    else
    {
        <p class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s·∫£n ph·∫©m n√†y.</p>
    }

    <!-- üìù FORM G·ª¨I REVIEW -->
    @if (User.Identity?.IsAuthenticated ?? false)
    {
        <h4 class="mt-4 fw-semibold">Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n</h4>
        <form asp-controller="Reviews" asp-action="Create" method="post" class="mt-3">
            <input type="hidden" name="ProductId" value="@Model.Id" />

            <div class="mb-3">
                <label class="form-label fw-semibold">S·ªë sao (1‚Äì5)</label>
                <input type="number" name="Rating" min="1" max="5" class="form-control" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">B√¨nh lu·∫≠n</label>
                <textarea name="Comment" class="form-control" rows="3" placeholder="Vi·∫øt nh·∫≠n x√©t c·ªßa b·∫°n..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary">
                <i class="bi bi-send"></i> G·ª≠i ƒë√°nh gi√°
            </button>
        </form>
    }
    else
    {
        <p class="text-muted mt-3">
            B·∫°n c·∫ßn <a asp-controller="Account" asp-action="Login">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ ƒë√°nh gi√° s·∫£n ph·∫©m.
        </p>
    }
</div>

<style>
    h2, h3, h4 {
        font-family: 'Segoe UI', sans-serif;
    }

    .card-img-top:hover {
        transform: scale(1.03);
        transition: transform 0.3s ease;
    }

    .border {
        border-color: #e0e0e0 !important;
    }

    .text-warning i {
        color: #ffc107;
    }
</style>
